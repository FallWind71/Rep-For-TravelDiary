<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¹¿å·æ™¯ç‚¹</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: url('/imagesxjp/å¹¿å·èƒŒæ™¯.png') no-repeat center center fixed;
            background-size: cover;
            overflow-x: hidden;
            overflow-y: hidden;
        }
        html {
            overflow-x: hidden;
            overflow-y: hidden;
        }
        iframe {
            overflow-x: hidden;
            overflow-y: hidden;
            height: 100%;
        }
        .spot-menu {
            position: relative;
            width: 220px;
            margin: 0;
            padding: 0;
            border-radius: 10px 0 0 10px !important;
        }
        .spot-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .spot-menu li {
            background: #fff;
            margin-bottom: 12px;
            padding: 14px 18px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            font-size: 1.1em;
            color: #333;
            cursor: pointer;
            transition: background 0.2s;
        }
        .spot-menu li:hover,
        .spot-menu li.active {
            background: #ffe082;
        }
        .spot-content-area {
            flex: 1 1 0;
            background: rgba(255,255,255,0.92);
            border-radius: 0 16px 16px 0;
            margin: 0;
            min-width: 0;
            position: relative;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            padding: 32px 24px 24px 24px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .tab-header {
            position: absolute;
            top: 0;
            right: 24px;
            display: flex;
            width: calc(100% - 48px);
            flex-direction: row;
            margin-bottom: 0;
            gap: 0;
        }
        .tab-underline {
            position: absolute;
            left: 0;
            right: 0;
            top: 100%;
            height: 2px;
            background: #e0e0e0;
            border-radius: 2px;
            z-index: 1;
        }
        .tab-btn {
            background: #fffbe6;
            border: 1.5px solid #ffd600;
            border-radius: 8px 8px 0 0;
            padding: 8px 24px;
            font-size: 1em;
            cursor: pointer;
            color: #333;
            font-weight: bold;
            transition: background 0.2s, color 0.2s;
        }
        .tab-btn.active {
            background: #ffd600;
            color: #fff;
        }
        .tab-content-wrapper {
            border: 2px dashed #bbb;
            border-radius: 12px;
            padding: 24px 18px 18px 18px;
            margin-top: 16px;
            background: #fcfcfc;
            min-height: 120px;
            box-sizing: border-box;
            position: relative;
            max-height: 520px;
            overflow: hidden;
        }
        .tab-content {
            margin: 0;
            font-size: 1.1em;
            min-height: 80px;
            max-height: 480px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .album-controls { text-align: right; margin-bottom: 10px; }
        .album-mode-btn { margin-right: 8px; padding: 6px 18px; border-radius: 6px; border: 1.5px solid #ffd600; background: #fffbe6; color: #333; font-weight: bold; cursor: pointer; }
        .album-mode-btn.active { background: #ffd600; color: #fff; }
        .album-container { width: 100%; }
        .photo-grid { display: flex; flex-wrap: wrap; gap: 18px; justify-content: flex-start; }
        .photo-item { width: 180px; border-radius: 10px; overflow: hidden; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.06); text-align: center; }
        .photo-item img { width: 100%; height: 120px; object-fit: cover; }
        .slideshow-container { width: 320px; margin: 0 auto; position: relative; }
        .slideshow-img { width: 320px; height: 220px; object-fit: cover; border-radius: 10px; }
        .photo-caption, .slide-caption, .slide-counter { display: none !important; }
        .slideshow-flex { display: flex; align-items: center; justify-content: center; }
        .slideshow-arrow { background: #fffbe6; border: 1.5px solid #ffd600; border-radius: 50%; width: 38px; height: 38px; font-size: 10.5px; color: #333; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 0 12px; }
        .slideshow-img { width: 320px; height: 220px; object-fit: cover; border-radius: 10px; }
        .slideshow-mode {
          background: url('/imgszc/å¹¿å·èƒŒæ™¯.gif') center center no-repeat;
          background-size: cover;
          position: relative;
          overflow: hidden;
        }
        .slideshow-mode::before {
          content: "";
          position: absolute;
          left: 0; top: 0; right: 0; bottom: 0;
          background: rgba(255,255,255,0.15);
          z-index: 1;
          pointer-events: none;
        }
        .slideshow-container, .slideshow-flex, .slideshow-img, .slideshow-arrow {
          position: relative;
          z-index: 2;
        }
        .collection-mode .photo-item img {
          width: 300px;
          height: 210px;
          object-fit: cover;
          border-radius: 10px;
        }
        .slideshow-mode .slideshow-img {
          width: 800px;
          height: 520px;
          object-fit: cover;
          border-radius: 10px;
        }
        figcaption {
            font-size: 0.98em;
            color: #888;
            font-weight: 400;
            text-align: center;
            margin-top: 6px;
        }
        #amap-container {
            width: 100vw;
            height: 300px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body>
    <audio id="bgm" src="/music/szc.mp3" autoplay loop style="display:none"></audio>
    <script>
      document.addEventListener('click', function playMusicOnce() {
        var audio = document.getElementById('bgm');
        if (audio.paused) audio.play();
        document.removeEventListener('click', playMusicOnce);
      });
    </script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=e26421ec12176a4eddb8cd2d70df1057"></script>
    <script>
      var spots = [
        {
          name: 'å¹¿å·å¡”',
          position: [113.324, 23.109],
          address: 'å¹¿å·å¸‚æµ·ç åŒºé˜…æ±Ÿè¥¿è·¯222å·'
        },
        {
          name: 'ä¸­å±±å¤§å­¦',
          position: [113.297, 23.096],
          address: 'å¹¿å·å¸‚æµ·ç åŒºæ–°æ¸¯è¥¿è·¯135å·'
        },
        {
          name: 'é•¿éš†',
          position: [113.338, 23.006],
          address: 'å¹¿å·å¸‚ç•ªç¦ºåŒºæ±‰æºªå¤§é“ä¸œä¸é•¿éš†åœ°é“å¤§é“äº¤æ±‡å¤„'
        },
        {
          name: 'çƒˆå£«é™µå›­',
          position: [113.259, 23.135],
          address: 'å¹¿å·å¸‚è¶Šç§€åŒºä¸­å±±äºŒè·¯92å·'
        },
        {
          name: 'å­™è€€å¨æ¼”å”±ä¼š',
          position: [113.326, 23.137],
          address: 'å¹¿å·å¸‚ç™½äº‘åŒºç™½äº‘å¤§é“å—1039å·å®èƒ½å¹¿å·å›½é™…ä½“è‚²æ¼”è‰ºä¸­å¿ƒ'
        }
      ];
      var centerLng = (113.324 + 113.297 + 113.338 + 113.326) / 4;
      var centerLat = (23.109 + 23.096 + 23.006 + 23.137) / 4;
      var centerPosition = [centerLng, centerLat];
      var map, markers = [];
      window.onload = function() {
        try {
          map = new AMap.Map('amap-container', {
            center: spots[0].position,
            zoom: 14,
            viewMode: '2D'
          });
          spots.forEach(function(spot, index) {
            var circle = new AMap.Circle({
              center: spot.position,
              radius: 100,
              strokeColor: '#0066cc',
              strokeWeight: 2,
              strokeOpacity: 1,
              fillColor: '#0066cc',
              fillOpacity: 1,
              zIndex: 10
            });
            var infoWindow = new AMap.InfoWindow({
              content: `<div style="padding:12px;transform:scale(0.9);border-radius:8px;"><h3 style="margin:0 0 6px 0;color:#333;font-size:18px;font-weight:bold;text-align:center;">${spot.name}</h3><p style="margin:0;color:#666;font-size:14px;text-align:center;line-height:1.4;">${spot.address}</p></div>`,
              offset: new AMap.Pixel(0, -1)
            });
            markers.push({
              position: spot.position,
              circle: circle,
              infoWindow: infoWindow,
              name: spot.name
            });
          });
          handleMenuClick(0);
          console.log('é«˜å¾·åœ°å›¾åˆå§‹åŒ–æˆåŠŸï¼Œå·²æ·»åŠ æ™¯ç‚¹æ ‡è®°');
        } catch (error) {
          console.error('é«˜å¾·åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
          document.getElementById('amap-container').innerHTML = '<div style="width:100%;height:100%;background:#f0f0f0;display:flex;align-items:center;justify-content:center;color:#666;font-size:16px;">åœ°å›¾åŠ è½½ä¸­...</div>';
        }
      };
      function handleMenuClick(index) {
        if (map && markers[index]) {
          map.setCenter(markers[index].position);
          map.setZoom(14);
          markers.forEach(function(m) {
            map.remove(m.circle);
          });
          map.add(markers[index].circle);
          markers[index].infoWindow.open(map, markers[index].position);
        }
      }
    </script>
    <div id="amap-container" style="width:100vw;height:300px;"></div>
    <hr style="margin:0; border: none; border-top: 2px solid #ffd600; width: 100vw;">
    <div style="display:flex;align-items:stretch;height:calc(100vh - 300px);margin:0;padding:0;">
        <div class="spot-menu" style="width:220px;background:#fff;box-sizing:border-box;margin:0;padding:0;">
            <div style="font-size:1.3em;font-weight:bold;margin-bottom:18px;color:#333;letter-spacing:2px;
                background:#fff;border:2px solid #ffd600;border-radius:10px;padding:10px 0;text-align:center;width:100%;box-sizing:border-box; box-shadow:0 2px 8px rgba(0,0,0,0.06);margin:0;">
                æ™¯ç‚¹æ‰“å¡
            </div>
            <ul style="background:#fff;border:2px solid #ffd600;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.06);padding:10px 0 10px 0;margin:0;width:100%;box-sizing:border-box;">
                <li>å¹¿å·å¡”</li>
                <li>ä¸­å±±å¤§å­¦</li>
                <li>é•¿éš†</li>
                <li>çƒˆå£«é™µå›­</li>
                <li>å­™è€€å¨æ¼”å”±ä¼š</li>
            </ul>
        </div>
        <hr style="align-self:stretch;margin:0;padding:0;border:none;border-left:2px solid #ffd600;height:100%;">
        <div class="spot-content-area">
          <div class="tab-header">
            <button class="tab-btn active" data-tab="log">æ—¥å¿—</button>
            <button class="tab-btn" data-tab="album">ç›¸å†Œ</button>
            <button class="tab-btn" data-tab="message">ç•™è¨€æ¿</button>
            <div class="tab-underline"></div>
          </div>
          <div class="tab-content-wrapper">
            <div class="tab-content log-content">è¿™é‡Œæ˜¯æ—¥å¿—å†…å®¹</div>
            <div class="tab-content album-content" style="display:none;">
              <div class="album-controls" style="margin-bottom:16px;">
                <button class="album-mode-btn active" data-mode="collection">é›†åˆæ¨¡å¼</button>
                <button class="album-mode-btn" data-mode="slideshow">æ”¾æ˜ æ¨¡å¼</button>
              </div>
              <div class="album-container">
                <div class="collection-mode">
                  <div class="photo-grid" id="photoGrid"></div>
                </div>
                <div class="slideshow-mode" style="display:none;">
                  <div class="slideshow-container slideshow-flex">
                    <button class="prev-btn slideshow-arrow">â®</button>
                    <img class="slideshow-img" src="/images/zjj1.jpg" alt="æ”¾æ˜ ">
                    <button class="next-btn slideshow-arrow">â¯</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-content message-content" style="display:none;">
              <div style='margin-bottom:12px;display:flex;gap:8px;align-items:center;'>
                <span>æ¬¢è¿ç•™è¨€!!!</span><span style='font-size:40px;'>âœ</span><span style='font-size:40px;'>âœ</span>
              </div>
              <input id="nickname-input" type="text" placeholder="æ˜µç§°ï¼ˆå¿…å¡«ï¼‰" style="width:120px;padding:4px 8px;border-radius:6px;border:1px solid #ffd600;font-size:1em;" maxlength="12">
              <br>
              <br>
              <textarea id="message-textarea" style="width:100%;height:60px;resize:vertical;border-radius:8px;border:1px solid #ffd600;padding:8px;font-size:1em;box-sizing:border-box;" placeholder="æƒ³è¯´äº›ä»€ä¹ˆå‘¢ğŸ¤”"></textarea>
              <br>
              <span style='font-size:20px; transform: scaleX(-1); display: inline-block;'>ğŸ’•</span><span style='font-size:20px;'>ğŸ’“</span>
              <button id="add-message-btn" style='background:#ffd600;color:#fff;border:none;border-radius:6px;padding:6px 18px;font-size:1em;cursor:pointer;'>æ·»åŠ </button>
              <span style='font-size:20px;'>ğŸ’“</span><span style='font-size:20px;'>ğŸ’•</span>
              <div id="message-list" style="margin-top:18px;"></div>
            </div>
          </div>
        </div>
    </div>
    <div id="imgModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;">
      <img id="modalImg" src="" alt="å¤§å›¾" style="max-width:90vw;max-height:90vh;box-shadow:0 4px 32px #000;border-radius:12px;">
    </div>
    <script>
        var menuLis = document.querySelectorAll('.spot-menu li');
        var spotLogs = [
          `<div>
            <h style="color:blue;">6.10æ™šï¼Œå‚åŠ å®Œå—ç§‘å¤§æœºè¯•ï¼ˆåç»­æ˜¯æ²¡é€šè¿‡ï¼Œæˆ‘æ‰¿è®¤èœæ˜¯åŸç½ª......ï¼‰ï¼Œå’Œæˆ‘çˆ¸å»å‚è§‚â€œå°è›®è…°â€â€”â€”å¹¿å·å¡”ã€‚</h>
            <br>
            <p>
              æ„Ÿå—ä¸€ä¸‹å¹¿å·å¡”600ç±³çš„ç»Ÿæ²»åŠ›!!
            </p>
            <img src="imggz/1.jpg" style="display:block; margin:0 auto; width:40%;">
            <figure style="text-align:center;">
              <img src="imggz/2.jpg" width="35%;">
              <img src="imggz/3.jpg" width="60%;">
              <figcaption>
                å¤œæ™¯å¾ˆç¾ï¼Œå¥‡ç‰¹çš„é€ å‹æ­é…å¤œå¹•ï¼Œæœ‰ç§å‡ ä½•ç¾æ„Ÿï¼Ÿï¼
                <br>
                å³å›¾äº®ç‚¹å‘ç°æ²¡ï¼Œå·¦è¾¹çš„å¤å¡”å’Œå³è¾¹çš„å¹¿å·å¡”ï¼Œå¤å…¸ä¸ç°ä»£çš„ç¢°æ’ã€‚
              </figcaption>
            </figure>
            <figure style="text-align:center;">
              <img src="imggz/4.jpg" width="40%;">
              <img src="imggz/5.jpg" width="40%;">
              <figcaption>
                æˆ‘çˆ¸ç»™æˆ‘æ‹çš„ğŸ˜ŠğŸ˜Š
              </figcaption>
              <figure style="text-align:center;">
                <img src="imggz/6.jpg" width="60%;">
                <figcaption>
                  å‡†å¤‡ä¸Šå¡”äº†ï¼Œæ²¡æƒ³åˆ°çº¤ç»†çš„å¡”èº«é‡Œé¢å±…ç„¶å¤§æœ‰æ´å¤©ğŸ˜²
                </figcaption>
              </figure>
              <video controls style="width:25%; height:auto; display:block; margin:0 auto;">
                <source src="imggz/1.mp4" type="video/mp4">
              </video>
              <p>ç»ˆäºè½®åˆ°æˆ‘æ‹è¿™ä¸ªè½¬åœºäº† ğŸ¥³ ğŸ¥³
                <figure style="text-align:center;">
                  <img src="imggz/7.jpg" width="35%;">
                  <img src="imggz/8.jpg" width="35%;">
                  <img src="imggz/9.jpg" width="35%;">
                  <figcaption>
                    å¡”å†…å¤§å…ï¼Œä¸ºäº†è®©æ¸¸å®¢æ›´å¥½åœ°ä¿¯ç°åœ°é¢ï¼Œç‰¹æ„å…³é—­ç¯å…‰ï¼ˆå€¾æ–œè½åœ°ç»ç’ƒå¥½è¯„ğŸ˜†ğŸ˜†ï¼‰
                  </figcaption>
                </figure>
                 <figure style="text-align:center;">
                  <img src="imggz/10.jpg" width="40%;">
                  <img src="imggz/11.jpg" width="40%;">
                    å¤–é¢è¿˜æœ‰å„ç§æ¸¸ä¹é¡¹ç›®ã€‚
                  </figcaption>
                </figure>
                <hr>
                <p>å½“æ—¥QQåŠ¨æ€ã€‚</p>
                <img src="imggz/12.jpg" width="30%;">
          </div>`,
          `<div>
            <h style="color:blue;">æ¬¡æ—¥ä¸€æ—©ï¼Œå»ä¸­å¤§å—æ ¡åŒºå‚è§‚ï¼ˆæˆ‘ä»¬å¹¿ä¸œäººçš„å°æ¸…åï¼‰ã€‚æ„Ÿè°¢ä¸­å¤§å­¦å§å¸¦æˆ‘ä»¬è¿›æ ¡å›­ğŸ‰ğŸ‰</h>
            <p style="text-decoration:underline wavy blue;">
              ä¸­å¤§å—æ ¡åŒºæ˜¯æœ€æœ‰åº•è•´çš„æ ¡åŒºï¼Œæ¯—é‚»ç æ±Ÿï¼Œæ ¡å›­å†…å»ºç­‘å¤šä¸ºçº¢å¢™ï¼Œç»¿æ ‘æˆè«ï¼Œéå¸¸æ¸…å¹½ã€‚
            </p>
            <figure style="text-align:center;">
              <img src="imggz/13.jpg" width="60%";>
              <figcaption>
                ç»å…¸æ ¡é—¨æ‰“å¡
                </figcaption>
              </figure>
              <figure style="text-align:center;">
              <img src="imggz/14.jpg" width="60%";>
              <figcaption>
                åœ°å›¾ä¸€ä»½
                </figcaption>
              </figure>
              <hr>
              <br>
              <p style="color:pink;">æ¥ä¸‹æ¥è®©æˆ‘å¸¦ä½ ä»¬æ¬£èµä¸­å¤§ç‹¬æœ‰çš„æµªæ¼«ã€‚</p>
              <figure style="text-align:center;">
                <img src="imggz/15.jpg" width="50%";>
                <img src="imggz/16.jpg" width="50%";>
                <img src="imggz/17.jpg" width="50%";>
                <img src="imggz/18.jpg" width="50%";>
                <img src="imggz/19.jpg" width="50%";>
                <img src="imggz/20.jpg" width="50%";>
                <figcaption>è¿œå¤„æ˜¯å›½çˆ¶çš„é›•åƒ</figcaption>
                <img src="imggz/21.jpg" width="50%";>
                <img src="imggz/22.jpg" width="50%";>
                <img src="imggz/23.jpg" width="50%";>
                <img src="imggz/24.jpg" width="50%";>
                <img src="imggz/26.jpg" width="50%";>
                <img src="imggz/28.jpg" width="50%";></img>
                </figure>
                <p style="text-decoration: underline dotted green;">
                  èµ°å‡ºæ ¡é—¨å°±æ˜¯ç æ±Ÿè¾¹ï¼Œå¤ªäº«å—äº†ã€‚
                </p>
                <figure>
                  <img src="imggz/25.jpg" width="40%";></img>
                  <img src="imggz/27.jpg" width="40%";></img>
                  </figure>
                  <figure>
                    <img src="imggz/29.jpg" width="20%";></img>
                    <figcaption>
                      å½“æ—¥QQåŠ¨æ€
                    </figcaption>
            </div>`,
          `<div><h3>ä¸–ç•Œä¹‹çª—</h3><p>ä¸–ç•Œä¹‹çª—æ˜¯æ·±åœ³è‘—åçš„ä¸»é¢˜å…¬å›­ï¼Œæ±‡é›†äº†ä¸–ç•Œå„åœ°çš„è‘—åå»ºç­‘å’Œæ–‡åŒ–æ™¯è§‚ã€‚</p></div>`,
          `<div><h3>æ·±åœ³è¥¿äº¤åŒä¹¡ä¼š</h3><p>è¥¿å®‰äº¤é€šå¤§å­¦æ·±åœ³æ ¡å‹ä¼šï¼Œä¸ºåœ¨æ·±åœ³çš„è¥¿äº¤æ ¡å‹æä¾›äº¤æµå¹³å°ã€‚</p></div>`
        ];
        var images = [
          {src:'/images/szc1.jpg'},
          {src:'/images/szc2.jpg'},
          {src:'/images/szc3.jpg'},
          {src:'/images/szc4.jpg'},
          {src:'/images/szc5.jpg'},
          {src:'/images/szc6.jpg'},
          {src:'/images/szc7.jpg'},
          {src:'/images/szc8.jpg'}
        ];
        function updateSpotContent(idx) {
          document.querySelector('.log-content').innerHTML = spotLogs[idx];
        }
        if(menuLis.length) {
          menuLis.forEach(function(l){l.classList.remove('active');});
          menuLis[0].classList.add('active');
          updateSpotContent(0);
        }
        menuLis.forEach(function(li,idx){
          li.onclick = function(){
            menuLis.forEach(function(l){l.classList.remove('active');});
            li.classList.add('active');
            updateSpotContent(idx);
            handleMenuClick(idx);
          };
        });
        var cityAbbr = 'gz';
        async function loadMessageList() {
            try {
                const response = await fetch(`http://1.95.203.92:9099/comments/${cityAbbr}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const list = await response.json();
                const messageList = document.getElementById('message-list');
                let html = '';
                if (list.length === 0) {
                    html = "<div style='color:#aaa;'>æš‚æ— ç•™è¨€</div>";
                } else {
                    html = list
                        .filter(msg => msg.nick && msg.nick !== 'åŒ¿å')
                        .map((msg, idx) => {
                            const date = new Date(msg.date).toLocaleString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            return `<div style='margin-bottom:10px;padding:8px 12px;background:#fffbe6;border-radius:6px;border:1px solid #ffe082;word-break:break-all;'>
                                        <span style='color:#2196f3;font-weight:bold;margin-right:8px;'>${msg.nick}:</span>
                                        <span style='color:#333;'>${msg.text}</span>
                                        <span style='float:right;color:#999;font-size:0.95em;'>${date}</span>
                                    </div>`;
                        })
                        .join('');
                }
                messageList.innerHTML = html;
            } catch (err) {
                console.error('åŠ è½½è¯„è®ºå¤±è´¥:', err);
                document.getElementById('message-list').innerHTML = "<div style='color:#aaa;'>åŠ è½½è¯„è®ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>";
            }
        }
        async function addMessage() {
            const nickname = document.getElementById('nickname-input').value.trim();
            const text = document.getElementById('message-textarea').value.trim();
            if (!nickname) {
                alert('è¯·å¡«å†™æ˜µç§°');
                document.getElementById('nickname-input').focus();
                return;
            }
            if (!text) {
                alert('è¯·è¾“å…¥ç•™è¨€å†…å®¹');
                return;
            }
            try {
                const response = await fetch(`http://1.95.203.92:9099/comments/${cityAbbr}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nick: nickname, text })
                });
                if (response.ok) {
                    document.getElementById('nickname-input').value = '';
                    document.getElementById('message-textarea').value = '';
                    loadMessageList();
                } else {
                    alert('æäº¤è¯„è®ºå¤±è´¥ï¼š' + response.statusText);
                }
            } catch (err) {
                console.error('æäº¤è¯„è®ºå¤±è´¥:', err);
                alert('æäº¤è¯„è®ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        function loadMessageTab() {
            loadMessageList();
            document.getElementById('message-textarea').value = '';
        }
        document.addEventListener('DOMContentLoaded', function() {
            const btn = document.getElementById('add-message-btn');
            if (btn && !btn.onclick) btn.onclick = addMessage;
            Array.from(document.querySelectorAll('.tab-btn')).forEach(function(btn){
                btn.onclick = function(){
                    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
                    btn.classList.add('active');
                    if(btn.dataset.tab==='log'){
                        document.querySelector('.log-content').style.display = '';
                        document.querySelector('.album-content').style.display = 'none';
                        document.querySelector('.message-content').style.display = 'none';
                    }else if(btn.dataset.tab==='album'){
                        document.querySelector('.log-content').style.display = 'none';
                        document.querySelector('.album-content').style.display = '';
                        document.querySelector('.message-content').style.display = 'none';
                    }else{
                        document.querySelector('.log-content').style.display = 'none';
                        document.querySelector('.album-content').style.display = 'none';
                        document.querySelector('.message-content').style.display = '';
                        loadMessageTab();
                    }
                };
            });
            loadMessageList();
        });
        function renderCollection() {
          var html = images.map(function(img){
            return '<div class="photo-item"><img src="'+img.src+'" alt=""></div>';
          }).join('');
          document.getElementById('photoGrid').innerHTML = html;
        }
        var modeBtns = document.querySelectorAll('.album-mode-btn');
        var collection = document.querySelector('.collection-mode');
        var slideshow = document.querySelector('.slideshow-mode');
        var slideImg = document.querySelector('.slideshow-img');
        var prevBtn = document.querySelector('.prev-btn');
        var nextBtn = document.querySelector('.next-btn');
        var current = 0;
        var playing = false;
        var timer = null;
        function showSlide(idx){
          if(idx<0) idx=images.length-1;
          if(idx>=images.length) idx=0;
          current=idx;
          slideImg.src=images[idx].src;
        }
        function play(){
          playing=true;
          timer=setInterval(function(){
            showSlide(current+1);
          },2000);
        }
        function pause(){
          playing=false;
          if(timer) clearInterval(timer);
        }
        modeBtns.forEach(function(btn){
          btn.onclick=function(){
            modeBtns.forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            var albumContent = document.querySelector('.album-content');
            if(btn.dataset.mode==='collection'){
              collection.style.display='';
              slideshow.style.display='none';
              albumContent.style.overflowY = 'auto';
              pause();
            }else{
              collection.style.display='none';
              slideshow.style.display='';
              albumContent.style.overflowY = 'hidden';
              showSlide(current);
              play();
            }
          };
        });
        prevBtn.onclick=function(){showSlide(current-1);};
        nextBtn.onclick=function(){showSlide(current+1);};
        renderCollection();
        showSlide(0);
        (function(){
          var modal = document.getElementById('imgModal');
          var modalImg = document.getElementById('modalImg');
          document.getElementById('photoGrid').onclick = function(e){
            if(e.target && e.target.tagName==='IMG'){
              modalImg.src = e.target.src;
              modal.style.display = 'flex';
            }
          };
          modal.onclick = function(e){
            if(e.target === modal) modal.style.display = 'none';
          };
        })();
    </script>
</body>
</html>
